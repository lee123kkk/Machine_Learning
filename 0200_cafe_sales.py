#0200_cafe_sales
'''
1. 시나리오: "오늘 우리 카페, 얼마를 벌 수 있을까?"
카페의 하루 매출은 단순히 손님 수만으로 결정되지 않습니다. 
날씨가 더우면 아이스 음료가 잘 나가고, 배달 앱에 광고를 켜두면 주문이 더 들어오겠죠. 
이 세 가지 원인을 종합해서 결과를 예측해 보겠습니다.
x_1 (원인 1): 하루 방문객 수 (명)
x_2 (원인 2): 오늘의 평균 기온 (℃)
x_3 (원인 3): 배달 앱 일일 광고비 (만원)
y (결과): 하루 총 매출 (만원)

[우리가 몰래 숨겨둔 매출 규칙]
W_1 (방문객): 1명당 0.5만원(5천 원)의 마진이 남습니다.
W_2 (기온): 기온이 1도 오를 때마다 아이스 음료가 팔려 2만원씩 매출이 오릅니다.
W_3 (광고): 광고비를 1만원 쓸 때마다 3만원의 추가 매출이 발생합니다.
b (기본): 문만 열어놔도 들어오는 동네 단골 매출 10만원이 항상 깔려있습니다.
수학 공식: y = 0.5x_1 + 2x_2 + 3x_3 + 10
이제 이 규칙을 모르는 AI에게 6일 치의 영업 장부(데이터)만 주고 스스로 깨우치게 해보겠습니다.
'''
import numpy as np
import tensorflow as tf

# 1. 학습 데이터 준비 (6일 치의 카페 영업 장부)
# x_data: [방문객 수, 기온, 광고비]
x_data = np.array([
    [100., 20., 5.],   # 1일 차: 100명, 20도, 광고비 5만원
    [80., 15., 3.],    # 2일 차
    [120., 25., 10.],  # 3일 차
    [50., 10., 0.],    # 4일 차 (비 오는 추운 날)
    [200., 30., 20.],  # 5일 차 (무더운 주말, 광고 빵빵)
    [150., 22., 8.]    # 6일 차
], dtype=np.float32)

# y_data: [하루 총 매출(만원)] -> 숨겨진 공식에 맞춰 계산된 정답들
y_data = np.array([
    [115.], # 1일 차 정답
    [89.],  # 2일 차 정답
    [150.], # 3일 차 정답
    [55.],  # 4일 차 정답
    [230.], # 5일 차 정답
    [153.]  # 6일 차 정답
], dtype=np.float32)

# 2. 모델 정의 (정규화 도입!)
model = tf.keras.Sequential()

# 데이터를 압축해 주는 정규화 층을 첫 번째 관문으로 세웁니다. (입력 변수가 3개이므로 3)
normalizer = tf.keras.layers.Normalization(input_shape=[3,])
normalizer.adapt(x_data) # x_data의 규모(스케일)를 파악하게 합니다.
model.add(normalizer)

# 변환된 데이터를 받아 최종 매출(1개)을 계산하는 층을 연결합니다.
model.add(tf.keras.layers.Dense(units=1))

# 3. 컴파일 및 학습
# 정규화를 했기 때문에 학습률(learning_rate)을 0.1로 크게 줘도 inf 에러가 나지 않습니다!
sgd = tf.keras.optimizers.SGD(learning_rate=0.1)
model.compile(loss='mse', optimizer=sgd)

print("☕ AI가 카페 매출 패턴을 분석하고 있습니다... (잠시 대기)")
# 데이터를 작게 만들었기 때문에 300번만 학습해도 완벽에 가까워집니다.
model.fit(x_data, y_data, epochs=300, verbose=0)
print("[분석 완료!]")

# 4. 사용자 입력 및 예측 시스템
print("\n" + "="*40)
print("💰 AI 카페 일일 매출 예측기 가동")
print("="*40)

while True:
    try:
        print("\n(입력 예시: 120, 26, 5)")
        raw_input = input("👉 방문객 수(명), 기온(도), 광고비(만원)를 쉼표로 구분하여 입력 (종료는 'q'): ")
        
        if 'q' in raw_input.lower():
            print("프로그램을 종료합니다. 오늘도 번창하세요!")
            break
            
        # 쉼표를 기준으로 세 개의 숫자를 쪼개고 공백을 제거
        inputs = [x.strip() for x in raw_input.split(',')]
        
        if len(inputs) != 3:
            print("⚠ 정확히 세 개의 숫자를 쉼표로 구분해서 입력해주세요!")
            continue
            
        visitors = float(inputs[0])
        temperature = float(inputs[1])
        ad_spend = float(inputs[2])
        
        # [중요] 텐서플로우가 원하는 형태인 [[x1, x2, x3]] (2차원 행렬) 형태로 만들어줍니다.
        user_data = np.array([[visitors, temperature, ad_spend]], dtype=np.float32)
        
        # 모델 예측 (모델 내부의 normalizer가 알아서 스케일링까지 해줍니다)
        prediction = model.predict(user_data, verbose=0)
        expected_sales = prediction[0][0]
        
        print(f"\n✨ [AI 예측 결과] ✨")
        print(f" - 조건: 방문객 {visitors}명 / 기온 {temperature}도 / 광고비 {ad_spend}만원")
        print(f" - 오늘 예상되는 총 매출은 약 [{expected_sales:.1f}만원] 입니다!")
        print("-" * 40)
        
    except ValueError:
        print("⚠ 잘못된 입력입니다. 숫자와 쉼표만 사용해주세요.")
    except Exception as e:
        print(f"⚠ 알 수 없는 에러가 발생했습니다: {e}")




#==================================================================
'''
========================================
💰 AI 카페 일일 매출 예측기 가동
========================================

(입력 예시: 120, 26, 5)
👉 방문객 수(명), 기온(도), 광고비(만원)를 쉼표로 구분하여 입력 (종료는 'q'): 130, 30, 10   

✨ [AI 예측 결과] ✨
 - 조건: 방문객 130.0명 / 기온 30.0도 / 광고비 10.0만원
 - 오늘 예상되는 총 매출은 약 [165.1만원] 입니다!
----------------------------------------
'''

# 방문객 수익: 130명 * 0.5만원 = 65만원
#기온 수익: 30도 * 2만원 = 60만원
#광고 수익: 10만원 * 3만원 = 30만원
#기본 매출: 10만원
#실제 정답 (총합계): 65 + 60 + 30 + 10 = 165만원        

#=======================================================================
#
#
# 다중변수가 있을때 정규화를 통해서 정확한 답을 찾아낼 수 있다.