# AI ì•½ë¬¼ ê¶í•© íŒë…ê¸°(LMP)
import tensorflow as tf
import numpy as np

# ê²°ê³¼ ì¬í˜„ì„ ìœ„í•œ ì‹œë“œ ê³ ì •
tf.random.set_seed(777)

# 1. [ë°ì´í„° ì¤€ë¹„]
# ì…ë ¥: [ì•½ A ë³µìš©, ì•½ B ë³µìš©] (0: ì•ˆ ë¨¹ìŒ, 1: ë¨¹ìŒ)
x_data = np.array([[0, 0], [0, 1], [1, 0], [1, 1]], dtype=np.float32)

# ì¶œë ¥: [ì•ˆì „ ìƒíƒœ] (1: ì•ˆì „/íš¨ê³¼ìˆìŒ, 0: ìœ„í—˜/ë¶€ì‘ìš©)
# Aì™€ Bë¥¼ ë”°ë¡œ ë¨¹ìœ¼ë©´ ì•ˆì „(1)í•˜ì§€ë§Œ, ê°™ì´ ë¨¹ìœ¼ë©´(1,1) ìœ„í—˜(0)í•œ XOR ìƒí™©
y_data = np.array([[0], [1], [1], [0]], dtype=np.float32)

# 2. [ëª¨ë¸ êµ¬ì„±] ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡  (MLP)
model = tf.keras.Sequential()
# ì€ë‹‰ì¸µ: 8ê°œì˜ ë‰´ëŸ°ìœ¼ë¡œ ë³µì¡í•œ ê´€ê³„(ìƒí˜¸ì‘ìš©)ë¥¼ íŒŒì•…
model.add(tf.keras.layers.Dense(units=8, input_dim=2, activation='sigmoid'))
# ì¶œë ¥ì¸µ: ìµœì¢… ì•ˆì „ ì—¬ë¶€ íŒë‹¨ (0~1)
model.add(tf.keras.layers.Dense(units=1, activation='sigmoid'))

# 3. [ì»´íŒŒì¼] Adam ìµœì í™” ë„êµ¬ ì‚¬ìš©
model.compile(loss='binary_crossentropy', 
              optimizer=tf.keras.optimizers.Adam(learning_rate=0.1), 
              metrics=['accuracy'])

# ==========================================================
# [ì¶”ê°€ë¨] í•™ìŠµ í˜„í™©ì„ ê°ì‹œí•˜ëŠ” ì½œë°± (Drug Monitor)
# ==========================================================
class DrugMonitor(tf.keras.callbacks.Callback):
    def on_epoch_end(self, epoch, logs=None):
        # 1000ë²ˆ ì¤‘ 200ë²ˆë§ˆë‹¤ ìƒì¡´ ì‹ ê³  (ì´ 5ë²ˆ ì¶œë ¥)
        if (epoch + 1) % 200 == 0:
            print(f"ğŸ’Š í•™ìŠµ ì¤‘... Epoch {epoch + 1:4d}/1000 | Loss: {logs['loss']:.4f} | Accuracy: {logs['accuracy']:.2f}")
# ==========================================================

# 4. [í•™ìŠµ ìˆ˜í–‰]
print("==============================================")
print("ğŸ¤– AIê°€ ì•½ë¬¼ ìƒí˜¸ì‘ìš© ê·œì¹™ì„ í•™ìŠµí•©ë‹ˆë‹¤...")
print("==============================================")
history = model.fit(x_data, y_data, epochs=1000, verbose=0, callbacks=[DrugMonitor()])
print("âœ… í•™ìŠµ ì™„ë£Œ!\n")

# 5. [ì‹¤ì „ í…ŒìŠ¤íŠ¸] ê°€ìƒì˜ í™˜ì ì²˜ë°©ì „ ë¶„ì„
print("ğŸš‘ [AI ì•½ì‚¬] ì²˜ë°©ì „ ì•ˆì „ ì ê²€ ê²°ê³¼")
print("-" * 50)

# í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤: í™˜ìë“¤ì´ ì•½ì„ ë¨¹ìœ¼ë ¤ëŠ” 4ê°€ì§€ ìƒí™©
patients = np.array([
    [1, 0], # ìƒí™© 1: ì•½ Aë§Œ ë³µìš©
    [0, 1], # ìƒí™© 2: ì•½ Bë§Œ ë³µìš©
    [1, 1], # ìƒí™© 3: A+B ë™ì‹œ ë³µìš© (ìœ„í—˜!)
    [0, 0]  # ìƒí™© 4: ë³µìš© ì•ˆ í•¨
], dtype=np.float32)

predictions = model.predict(patients, verbose=0)
case_names = ["ì•½ Aë§Œ ë³µìš©", "ì•½ Bë§Œ ë³µìš©", "A+B ë™ì‹œ ë³µìš©", "ë³µìš© ì•ˆ í•¨"]

for i, pred in enumerate(predictions):
    prob = pred[0]
    # í™•ë¥ ì´ 0.5ë³´ë‹¤ í¬ë©´ ì•ˆì „(Safe), ì‘ìœ¼ë©´ ìœ„í—˜(Danger)
    status = "âœ… ì•ˆì „ (Safe)" if prob > 0.5 else "âŒ ìœ„í—˜ (Danger)"
    print(f"ìƒí™©: {case_names[i]:<12} | ì˜ˆì¸¡ì ìˆ˜: {prob:.4f} | íŒì •: {status}")

#==========================================================================
# ì•½ë¬¼ Aì™€ ì•½ë¬¼ Bë¥¼ ê°™ì´ ë¨¹ìœ¼ë©´ ë…ìœ¼ë¡œ ì„¤ì •
# XORì€ ë‹¨ìˆœí•œ ë…¼ë¦¬ ê²Œì´íŠ¸ë¥¼ ë„˜ì–´ ì¶©ëŒ ë°©ì§€ ì‹œìŠ¤í…œ, í™”í•™ ë°˜ì‘ ì˜ˆì¸¡, ë³´ì•ˆ ì‹œìŠ¤í…œ ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì— ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
